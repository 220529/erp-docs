# API 接口规范

## RESTful 规范

### URL 设计
```
GET    /api/customers          # 获取客户列表
GET    /api/customers/:id      # 获取客户详情
POST   /api/customers          # 创建客户
PUT    /api/customers/:id      # 更新客户
DELETE /api/customers/:id      # 删除客户

# 子资源
GET    /api/customers/:id/follows    # 获取客户跟进记录
POST   /api/customers/:id/follows    # 添加跟进记录

# 操作
PUT    /api/orders/:id/status        # 更新订单状态
POST   /api/payments/:id/confirm     # 确认收款
```

### HTTP 方法
| 方法 | 用途 | 幂等性 |
|-----|------|-------|
| GET | 获取资源 | 是 |
| POST | 创建资源 | 否 |
| PUT | 更新资源 | 是 |
| DELETE | 删除资源 | 是 |

## 请求格式

### 请求头
```
Authorization: Bearer <token>
Content-Type: application/json
```

### 分页参数
```
GET /api/customers?page=1&pageSize=10
```

### 筛选参数
```
GET /api/customers?status=new&keyword=张三
```

## 响应格式

### 成功响应
```json
{
  "code": 0,
  "message": "success",
  "data": { "id": 1, "name": "张三" }
}
```

### 列表响应
```json
{
  "code": 0,
  "data": {
    "list": [{ "id": 1, "name": "张三" }],
    "total": 100,
    "page": 1,
    "pageSize": 10
  }
}
```

### 错误响应
```json
{
  "code": 400,
  "message": "参数错误：手机号格式不正确",
  "error": "Bad Request"
}
```

## HTTP 状态码

| 状态码 | 说明 | 使用场景 |
|-------|------|---------|
| 200 | 成功 | GET/PUT/DELETE 成功 |
| 201 | 已创建 | POST 创建成功 |
| 400 | 请求错误 | 参数校验失败 |
| 401 | 未认证 | Token 无效或过期 |
| 403 | 禁止访问 | 无权限 |
| 404 | 未找到 | 资源不存在 |
| 500 | 服务器错误 | 服务端异常 |

## 认证方式

### JWT Token
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Token 结构
```json
{
  "sub": 1,           // 用户ID
  "username": "admin",
  "role": "admin",
  "iat": 1234567890,  // 签发时间
  "exp": 1234567890   // 过期时间
}
```

## 接口文档

Swagger 访问地址：`http://localhost:3000/api/docs`

### 装饰器使用
```typescript
@ApiTags('客户管理')
@Controller('customers')
export class CustomersController {
  
  @ApiOperation({ summary: '获取客户列表' })
  @ApiQuery({ name: 'page', required: false })
  @Get()
  async list(@Query() query: QueryCustomerDto) {
    // ...
  }
}
```
