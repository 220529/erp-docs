# 系统架构总览

## 整体架构

```
                                    ┌─────────────────┐
                                    │     用户        │
                                    └────────┬────────┘
                                             │
                    ┌────────────────────────┼────────────────────────┐
                    │                        │                        │
                    ▼                        ▼                        ▼
           ┌───────────────┐        ┌───────────────┐        ┌───────────────┐
           │   erp-web     │        │    m-hub      │        │   erp-code    │
           │   PC 管理端   │        │   移动端 H5   │        │   低代码脚本   │
           │   React+TS    │        │   React+TS    │        │   JavaScript  │
           │   :5173       │        │   :5174       │        │   VSCode      │
           └───────┬───────┘        └───────┬───────┘        └───────┬───────┘
                   │                        │                        │
                   └────────────────────────┼────────────────────────┘
                                            │
                                            ▼
                                   ┌─────────────────┐
                                   │   nginx-app    │
                                   │   反向代理      │
                                   │   SSL 证书      │
                                   │   :80/:443     │
                                   └────────┬────────┘
                                            │
                                            ▼
                                   ┌─────────────────┐
                                   │    erp-core    │
                                   │   NestJS 后端  │
                                   │   RESTful API  │
                                   │   :3000        │
                                   └────────┬────────┘
                                            │
                         ┌──────────────────┼──────────────────┐
                         │                  │                  │
                         ▼                  ▼                  ▼
                ┌───────────────┐  ┌───────────────┐  ┌───────────────┐
                │    MySQL      │  │    Redis      │  │   阿里云 OSS  │
                │   主数据库    │  │   缓存/会话   │  │   文件存储    │
                │   :3306       │  │   :6379       │  │               │
                └───────────────┘  └───────────────┘  └───────────────┘
```

## 项目职责

### erp-core（后端服务）
- **职责**: 提供 RESTful API，处理业务逻辑
- **技术**: NestJS 11 + TypeORM + MySQL
- **功能**: 用户认证、RBAC 权限、业务模块、低代码引擎、定时任务、文件上传

### erp-web（PC 前端）
- **职责**: 管理后台界面
- **技术**: React 18 + Ant Design + Vite
- **功能**: 动态菜单、权限按钮、业务管理、数据可视化

### erp-code（低代码脚本）
- **职责**: 存储和管理业务流程代码
- **技术**: JavaScript + VSCode 插件
- **功能**: 业务流程脚本、保存自动上传、乐观锁防冲突

### db-app（数据库服务）
- **职责**: 提供数据存储服务
- **技术**: MySQL 8 + Redis 7 + Docker
- **功能**: 数据持久化、缓存加速、数据备份

### nginx-app（网关服务）
- **职责**: 反向代理和 SSL 终结
- **技术**: Nginx + Let's Encrypt
- **功能**: 请求转发、HTTPS 加密、静态资源服务

### m-hub（移动端 H5）
- **职责**: 移动端活动页面
- **技术**: React + antd-mobile
- **功能**: 营销活动页、移动端适配

## 技术选型理由

| 技术 | 选型理由 |
|-----|---------|
| NestJS | TypeScript 原生支持、模块化架构、内置 DI/AOP |
| React + Ant Design | 组件化开发、企业级 UI、TypeScript 类型安全 |
| MySQL + Redis | MySQL 成熟稳定、Redis 高性能缓存 |
| Docker | 环境一致性、自动化 CI/CD、快速回滚 |

## 通信方式

### 请求流程
```
1. 前端发起请求（带 Token）
2. Nginx 转发到后端
3. 后端 Guard 校验 Token
4. 后端 Guard 校验权限
5. Controller 处理请求
6. Service 执行业务逻辑
7. Repository 操作数据库
8. 返回 JSON 响应
```

### 响应格式
```typescript
// 成功响应
{ "code": 0, "message": "success", "data": { ... } }

// 分页响应
{ "code": 0, "data": { "list": [...], "total": 100, "page": 1, "pageSize": 10 } }

// 错误响应
{ "code": 400, "message": "参数错误", "error": "Bad Request" }
```

## 环境配置

| 环境 | 前端 | 后端 | 数据库 |
|-----|------|-----|-------|
| 开发 | localhost:5173 | localhost:3000 | localhost:3306 |
| 生产 | erp.example.com | erp.example.com/api | 内网 IP:3306 |
