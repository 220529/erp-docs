# 收款管理

## 收款流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           收款流程图                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────┐         ┌─────────────┐         ┌─────────────┐          │
│   │  创建收款   │────────▶│  待确认     │────────▶│  已确认     │          │
│   │             │         │  PENDING    │         │  CONFIRMED  │          │
│   └─────────────┘         └──────┬──────┘         └─────────────┘          │
│                                  │                                          │
│                                  │ 取消                                     │
│                                  ▼                                          │
│                           ┌─────────────┐                                   │
│                           │  已取消     │                                   │
│                           │  CANCELLED  │                                   │
│                           └─────────────┘                                   │
│                                                                             │
│  收款方式：                                                                  │
│  • CASH: 现金                                                               │
│  • WECHAT: 微信                                                             │
│  • ALIPAY: 支付宝                                                           │
│  • BANK: 银行转账                                                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 收款字段

| 字段 | 说明 | 必填 |
|-----|------|-----|
| paymentNo | 收款单号（自动生成） | 是 |
| orderId | 关联订单 | 是 |
| amount | 收款金额 | 是 |
| method | 收款方式 | 是 |
| status | 收款状态 | 是 |
| confirmedBy | 确认人 | 否 |
| confirmedAt | 确认时间 | 否 |
| remark | 备注 | 否 |

## API 接口

| 接口 | 方法 | 说明 |
|-----|------|-----|
| /api/payments | GET | 收款列表 |
| /api/payments/:id | GET | 收款详情 |
| /api/payments | POST | 创建收款 |
| /api/payments/:id/confirm | POST | 确认收款 |
| /api/payments/:id/cancel | POST | 取消收款 |

## 业务规则

### 创建收款
1. 必须关联已签约的订单
2. 收款单号自动生成：`PAY + 年月日 + 4位序号`
3. 初始状态为 `pending`（待确认）
4. 收款金额不能超过订单未收金额

### 确认收款
1. 只有待确认状态可以确认
2. 确认后更新订单已收金额
3. 记录确认人和确认时间

### 取消收款
1. 只有待确认状态可以取消
2. 取消后不影响订单金额

### 权限控制
| 操作 | 权限标识 | 角色 |
|-----|---------|-----|
| 查看列表 | payment:list | 所有角色 |
| 创建收款 | payment:create | 销售、财务、管理员 |
| 确认收款 | payment:confirm | 财务、管理员 |
| 取消收款 | payment:cancel | 财务、管理员 |

## 前端页面

| 路由 | 组件 | 功能 |
|-----|------|-----|
| /payment/list | features/finance/List.tsx | 收款列表、筛选、确认/取消 |

## 统计指标

- 收款总额
- 待确认金额
- 本月收款
- 收款完成率
