# 常见问题 FAQ

## 开发环境

### 数据库连接失败
```
Error: connect ECONNREFUSED 127.0.0.1:3306
```

**解决方案**:
1. 确认 MySQL 容器已启动：`docker ps | grep mysql`
2. 检查端口映射：`docker-compose ps`
3. 验证连接信息：检查 `.env` 中的 `DB_HOST`、`DB_PORT`

### Redis 连接失败
```
Error: connect ECONNREFUSED 127.0.0.1:6379
```

**解决方案**:
1. 确认 Redis 容器已启动
2. 检查 Redis 密码配置是否正确
3. 本地开发可临时禁用密码

### 前端启动报错
```
Error: Cannot find module 'xxx'
```

**解决方案**:
```bash
rm -rf node_modules pnpm-lock.yaml
pnpm install
```

### TypeORM 迁移失败
```
Error: No migrations are pending
```

**解决方案**:
1. 检查迁移文件是否正确导出
2. 确认 `data-source.ts` 配置正确
3. 手动运行：`pnpm migration:run`

## 生产部署

### Docker 构建失败
```
Error: npm ERR! code ENOENT
```

**解决方案**:
1. 检查 `.dockerignore` 是否排除了必要文件
2. 确认 `package.json` 存在
3. 清理 Docker 缓存：`docker builder prune`

### 容器启动后立即退出
**排查步骤**:
```bash
docker logs <container_id>

# 常见原因
1. 环境变量缺失
2. 数据库连接失败
3. 端口被占用
```

### Nginx 502 Bad Gateway
**解决方案**:
1. 检查后端服务是否正常运行
2. 确认 Nginx upstream 配置正确
3. 检查容器网络是否互通

### SSL 证书问题
```
Error: certificate has expired
```

**解决方案**:
```bash
certbot renew --force-renewal
docker restart nginx-app
```

## 业务问题

### 登录失败
**排查步骤**:
1. 检查用户名密码是否正确
2. 确认用户状态是否启用
3. 查看后端日志定位具体错误

### 权限不足
```
Error: 没有操作权限
```

**解决方案**:
1. 检查用户角色是否正确分配
2. 确认角色是否拥有对应权限
3. 清除前端缓存后重新登录

### 文件上传失败
**排查步骤**:
1. 检查 OSS 配置是否正确
2. 确认文件大小是否超限
3. 验证 OSS Bucket 权限

### 低代码执行报错
**排查步骤**:
1. 检查脚本语法是否正确
2. 确认依赖的 API 是否可用
3. 查看执行日志定位错误

## 性能问题

### 接口响应慢
**优化方向**:
1. 检查 SQL 是否有慢查询
2. 添加必要的数据库索引
3. 使用 Redis 缓存热点数据
4. 分页查询避免全表扫描

### 前端加载慢
**优化方向**:
1. 开启 Gzip 压缩
2. 使用 CDN 加速静态资源
3. 路由懒加载
4. 图片压缩和懒加载

## 常用命令速查

```bash
# 后端
pnpm start:dev          # 开发模式
pnpm build              # 构建
pnpm migration:generate # 生成迁移
pnpm migration:run      # 运行迁移

# 前端
pnpm dev:main           # 开发模式
pnpm build:main         # 构建

# Docker
docker-compose up -d    # 启动服务
docker-compose down     # 停止服务
docker logs -f <name>   # 查看日志
docker exec -it <name> sh  # 进入容器

# 数据库
docker exec -it mysql mysql -uroot -p  # 进入 MySQL
```
