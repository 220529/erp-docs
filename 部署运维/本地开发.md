# 本地开发环境搭建

## 环境要求

| 工具 | 版本 | 说明 |
|-----|------|-----|
| Node.js | >= 18.0 | JavaScript 运行时 |
| pnpm | >= 8.0 | 包管理器 |
| Docker | >= 20.0 | 容器运行时 |
| Docker Compose | >= 2.0 | 容器编排 |
| VSCode | 最新版 | 推荐 IDE |

## 快速开始

### 1. 克隆项目
```bash
git clone <erp-core-repo>
git clone <erp-web-repo>
git clone <erp-code-repo>
git clone <db-app-repo>
```

### 2. 启动数据库
```bash
cd db-app
docker-compose up -d
docker-compose ps  # 验证服务
```

服务信息：
| 服务 | 地址 | 账号密码 |
|-----|------|---------|
| MySQL | localhost:3306 | root / root |
| Redis | localhost:6379 | redis123 |

### 3. 启动后端
```bash
cd erp-core
pnpm install
cp .env.example .env
pnpm migration:run
pnpm start:dev
```

后端服务：
- API: http://localhost:3000/api
- Swagger: http://localhost:3000/api/docs

### 4. 启动前端
```bash
cd erp-web
pnpm install
pnpm dev:main
```

前端服务：http://localhost:5173

### 5. 配置低代码（可选）
```bash
cd erp-code
npm install
# 编辑 config/dev.json
```

安装 VSCode 插件：Run On Save (emeraldwalk.RunOnSave)

## 环境变量配置

### erp-core/.env
```bash
NODE_ENV=development
PORT=3000

DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=root
DB_DATABASE=erp_core

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=redis123

JWT_SECRET=your-dev-secret-key
JWT_EXPIRES_IN=7d
```

### erp-web/.env.development
```bash
VITE_API_BASE_URL=http://localhost:3000/api
```

## 常见问题

### 数据库连接失败
```bash
docker-compose ps        # 检查容器状态
docker-compose logs mysql # 查看日志
docker-compose restart mysql # 重启
```

### 端口被占用
```bash
netstat -ano | findstr :3000  # 查看端口占用
taskkill /PID <pid> /F        # 杀死进程
```

### 依赖安装失败
```bash
pnpm store prune
rm -rf node_modules
pnpm install
```

### 迁移失败
```bash
pnpm typeorm migration:show -d src/database/data-source.ts
pnpm migration:revert
pnpm migration:run
```

## VSCode 推荐配置

### 插件推荐
- ESLint
- Prettier
- TypeScript Vue Plugin
- Run On Save (低代码开发)
- Docker

### settings.json
```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  }
}
```

## 开发流程

```
1. 拉取最新代码: git pull origin main
2. 安装依赖: pnpm install
3. 运行迁移: pnpm migration:run
4. 启动服务: pnpm start:dev / pnpm dev:main
5. 开发功能
6. 提交代码: git commit -m "feat: xxx"
```
